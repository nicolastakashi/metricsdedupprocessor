# Metrics Dedup Processor

<!-- status autogenerated section -->
| Status        |           |
| ------------- |-----------|
| Stability     | [development]: metrics   |
| Distributions | [] |
| Issues        | [![Open issues](https://img.shields.io/github/issues-search/open-telemetry/opentelemetry-collector-contrib?query=is%3Aissue%20is%3Aopen%20label%3Aprocessor%2Fgroupby%20&label=open&color=orange&logo=opentelemetry)](https://github.com/open-telemetry/opentelemetry-collector-contrib/issues?q=is%3Aopen+is%3Aissue+label%3Aprocessor%2Fgroupby) [![Closed issues](https://img.shields.io/github/issues-search/open-telemetry/opentelemetry-collector-contrib?query=is%3Aissue%20is%3Aclosed%20label%3Aprocessor%2Fgroupby%20&label=closed&color=blue&logo=opentelemetry)](https://github.com/open-telemetry/opentelemetry-collector-contrib/issues?q=is%3Aclosed+is%3Aissue+label%3Aprocessor%2Fgroupby) |
| [Code Owners](https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/CONTRIBUTING.md#becoming-a-code-owner)    | [@nicolastakashi](https://www.github.com/nicolastakashi) |

[development]: https://github.com/open-telemetry/opentelemetry-collector#development
<!-- end autogenerated section -->

## Description

This processor deduplicates metrics by ensuring that only metrics from the in-use replica are retained.

```yaml
processors:
  metricsdedup:
    replica_label: replica
    swap_timeout: 5m
```

## Defining in use replica

Below you can find the logic used to determine the in-use replica:

```mermaid
sequenceDiagram
    participant Processor
    participant Receiver
    participant ReplicaInfo

    Receiver->>Processor: Send metric with replica
    Processor->>ReplicaInfo: Load current replica info
    alt No current replica
        Processor->>ReplicaInfo: Set new replica and update timestamp
    else Current replica exists
        alt Replica matches current replica
            Processor->>ReplicaInfo: Update timestamp
        else Replica different from current replica
            alt Timestamp older than swap timeout
                Processor->>ReplicaInfo: Set new replica and update timestamp
            else Timestamp within swap timeout
                Processor->>ReplicaInfo: Retain current replica
            end
        end
    end
    Processor->>Receiver: Return in-use replica
```